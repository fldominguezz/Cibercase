# Documentación de la API: CiberCase API

## 1. Introducción

La API de CiberCase está construida con [FastAPI](https://fastapi.tiangolo.com/), un moderno framework de Python que permite, entre otras cosas, la **generación automática de documentación interactiva** a partir del propio código fuente.

Esta documentación es la fuente de verdad única para entender cómo interactuar con el backend. Detalla cada endpoint, sus parámetros, los datos que devuelve y los códigos de estado HTTP.

## 2. Acceso a la Documentación Interactiva

La documentación de la API es generada automáticamente por el backend y se puede acceder a través de dos interfaces diferentes mientras la aplicación se está ejecutando:

### 2.1. Swagger UI (Interfaz Recomendada)

*   **URL:** `[URL_DEL_BACKEND]/docs`
*   **Descripción:** Es una interfaz interactiva que no solo permite leer la documentación, sino también **probar los endpoints directamente desde el navegador**. Puede autenticarse usando el candado ("Authorize") en la parte superior derecha (usando un token JWT) y realizar llamadas reales a la API.

**Ejemplo de acceso en entorno de desarrollo:**
`http://localhost:8000/docs`

### 2.2. ReDoc

*   **URL:** `[URL_DEL_BACKEND]/redoc`
*   **Descripción:** Es una interfaz de documentación alternativa, puramente visual y no interactiva. Es ideal para una lectura más limpia y ordenada de los endpoints.

**Ejemplo de acceso en entorno de desarrollo:**
`http://localhost:8000/redoc`

## 3. Visión General de los Endpoints (Tags)

La API está organizada en las siguientes secciones o "tags", cada uno agrupando funcionalidades relacionadas:

*   **auth:** Endpoints para la autenticación de usuarios, incluyendo inicio de sesión (`/token`) para obtener el token JWT y verificación de sesión.
*   **users:** Gestión de usuarios, como obtener la lista de usuarios, crear nuevos usuarios y obtener detalles del usuario actual (`/me`).
*   **tickets:** El corazón de la aplicación. Permite crear, leer, actualizar y borrar tickets. Incluye endpoints para obtener tickets por ID, filtrar, añadir comentarios y gestionar evidencias.
*   **reports:** Endpoints dedicados a la generación de datos para el dashboard, como conteos por estado, severidad, categoría y promedios de tiempo de resolución.
*   **admin:** Operaciones reservadas para administradores, como la visualización de logs de auditoría.
*   **fortisiem:** Endpoint específico para la recepción de webhooks de FortiSIEM, que se encarga de parsear el XML y crear un ticket.
*   **eml:** Endpoints para el analizador de correos, incluyendo la subida y el análisis de archivos `.eml`.
*   **notifications:** Gestión de notificaciones para los usuarios.
*   **forms:** Gestión y envío de formularios dinámicos.
*   **websockets:** Endpoint para la conexión WebSocket que permite las actualizaciones en tiempo real.
*   **status:** Endpoint simple para verificar que la API está en funcionamiento.

## 4. Autenticación

La mayoría de los endpoints de la API están protegidos y requieren autenticación mediante un **Token JWT (JSON Web Token)**.

Para autenticarse en la documentación interactiva (Swagger UI):

1.  Primero, obtenga un token llamando al endpoint `POST /api/v1/auth/token` con el `username` (correo electrónico) y `password` de un usuario.
2.  Copie el `access_token` de la respuesta.
3.  Haga clic en el botón **"Authorize"** en la parte superior derecha de la página de Swagger.
4.  En la ventana emergente, escriba `Bearer ` (con un espacio al final) seguido de su token. Ejemplo: `Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`
5.  Haga clic en **"Authorize"** y cierre la ventana. Ahora todas sus peticiones desde la documentación estarán autenticadas.
